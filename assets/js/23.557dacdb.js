(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{514:function(s,n,a){"use strict";a.r(n);var t=a(24),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nginx基本配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx基本配置"}},[s._v("#")]),s._v(" nginx基本配置")]),s._v(" "),a("h2",{attrs:{id:"前端路由使用history模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端路由使用history模式"}},[s._v("#")]),s._v(" 前端路由使用history模式")]),s._v(" "),a("p",[a("strong",[s._v("try_files")]),s._v("属性会到硬盘里尝试找这个文件，当请求的url在 "),a("strong",[s._v("$uri $uri/")]),s._v(" 匹配路径下都找不到最后访问index.html。")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location / {\n    root   html;\n    index  index.html index.htm;\n    # 防止前端基于history模式路由刷新页面404\n    try_files $uri $uri/ /index.html;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"设置跨域代理请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置跨域代理请求"}},[s._v("#")]),s._v(" 设置跨域代理请求")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server {\n    listen       3001;\n\n    server_name  localhost;\n    \n    location /api/ {\n        # 替换请求url的/api/前缀\n        rewrite ^/api/(.*) /$1  break;\n\n        # 允许跨域的ip地址 如果设置成*时Access-Control-Allow-Credentials true;会失败\n        add_header Access-Control-Allow-Origin http://localhost:3000;\n\n        # add_header Access-Control-Allow-Headers *;\n        # 允许跨域的请求头\n        add_header Access-Control-Allow-Methods \"GET, POST, PUT, OPTIONS\";\n\n        # 允许跨域携带cookie\n        add_header Access-Control-Allow-Credentials true;\n\n        # 当请求是OPTIONS预检请求时 返回200 或者 204\n        if ($request_method = 'OPTIONS') {\n            return 200;\n        }\n\n        # 代理需要转发的目标地址\n        proxy_pass http://localhost:8888;\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[s._v("假设前端是在"),a("strong",[s._v("localhost的3000端口")]),s._v("允许发送一个"),a("strong",[s._v("http://localhost:3001/api/demo/test")]),s._v("的请求，由于访问的是3001端口访问的是nginx服务器，nginx会将 "),a("strong",[s._v("/api/")]),s._v(" 前缀去掉然后设置跨域的响应头并转发到"),a("strong",[s._v("http://localhost:8888")]),s._v("地址，所以最后转发的请求地址是"),a("strong",[s._v("http://localhost:8888/demo/test")]),s._v(".")]),s._v(" "),a("h2",{attrs:{id:"nginx-配置缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置缓存"}},[s._v("#")]),s._v(" nginx 配置缓存")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('location /test/ {\n\n  if ($request_uri ~* .*[.](js|css|map|jpg|png|svg|ico)$) {\n    # 非html缓存1个月 也可以使用expires来设置 这一步都是设置强缓存。\n    add_header Cache-Control "public, max-age=2592000";\n  }\n\n  if ($request_filename ~* ^.*[.](html|htm)$) {\n    # html文件设置协商缓存，也就是每次都询问服务器，服务器会根据Etag 和 Last-Modified来判断是否命中协商缓存，如果命中则返回304状态。\n    add_header Cache-Control "public, no-cache";\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"开启gzip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启gzip"}},[s._v("#")]),s._v(" 开启gzip")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("http {\n  # 开启gzip\n  gzip on;\n\n  # 启用gzip压缩的最小文件；小于设置值的文件将不会被压缩\n  gzip_min_length 1k;\n\n  # gzip 压缩级别 1-10 \n  gzip_comp_level 2;\n\n  # 进行压缩的文件类型。\n  gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;\n\n  # 是否在http header中添加Vary: Accept-Encoding，建议开启\n  gzip_vary on;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);